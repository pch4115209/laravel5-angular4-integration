!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("@angular/core"),require("rxjs/Observable"),require("rxjs/add/observable/from"),require("rxjs/add/operator/mergeAll")):"function"==typeof define&&define.amd?define("ngx-uploader",["@angular/core","rxjs/Observable","rxjs/add/observable/from","rxjs/add/operator/mergeAll"],t):"object"==typeof exports?exports["ngx-uploader"]=t(require("@angular/core"),require("rxjs/Observable"),require("rxjs/add/observable/from"),require("rxjs/add/operator/mergeAll")):e["ngx-uploader"]=t(e["@angular/core"],e["rxjs/Observable"],e["rxjs/add/observable/from"],e["rxjs/add/operator/mergeAll"])}(this,function(e,t,n,r){return function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="/",t(t.s=5)}([function(t,n){t.exports=e},function(e,t,n){"use strict";function r(e){if(0===e)return"0 Byte";var t=["Bytes","KB","MB","GB","TB","PB"],n=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,n)).toFixed(2))+" "+t[n]}n.d(t,"a",function(){return i}),t.b=r,n.d(t,"c",function(){return l});var i,o=n(0),a=(n.n(o),n(6)),s=(n.n(a),n(7)),u=(n.n(s),n(8));n.n(u);!function(e){e[e.Queue=0]="Queue",e[e.Uploading=1]="Uploading",e[e.Done=2]="Done",e[e.Canceled=3]="Canceled"}(i||(i={}));var l=function(){function e(){this.files=[],this.serviceEvents=new o.EventEmitter,this.uploads=[]}return e.prototype.handleFiles=function(e){var t=this;this.fileList=e,(n=this.files).push.apply(n,[].map.call(e,function(e,n){var r={fileIndex:n,id:t.generateId(),name:e.name,size:e.size,type:e.type,progress:{status:i.Queue,data:{percentage:0,speed:null,speedHuman:null,startTime:null,endTime:null}},lastModifiedDate:e.lastModifiedDate};return t.serviceEvents.emit({type:"addedToQueue",file:r,nativeFile:e}),t.uploads.push({file:r,sub:{instance:null}}),r})),this.serviceEvents.emit({type:"allAddedToQueue"});var n},e.prototype.initInputEvents=function(e){var t=this;e.subscribe(function(e){switch(e.type){case"uploadFile":var n=t.uploads.findIndex(function(t){return t.file===e.file});-1!==n&&(t.uploads[n].sub.instance=t.uploadFile(e.file,e).subscribe(function(e){t.serviceEvents.emit(e)}));break;case"uploadAll":var r=e.concurrency>0?e.concurrency:Number.POSITIVE_INFINITY;a.Observable.from(t.files.map(function(n){return t.uploadFile(n,e)})).mergeAll(r).subscribe(function(e){return t.serviceEvents.emit(e)});break;case"cancel":var o=e.id||null;if(!o)return;var s=t.uploads.findIndex(function(e){return e.file.id===o});-1!==s&&(t.uploads[s].sub&&t.uploads[s].sub.instance&&t.uploads[s].sub.instance.unsubscribe(),t.serviceEvents.emit({type:"cancelled",file:t.uploads[s].file}),t.uploads[s].file.progress.status=i.Canceled);break;case"cancelAll":t.uploads.forEach(function(e){e.sub&&e.sub.instance&&e.sub.instance.unsubscribe(),e.file.progress.status=i.Canceled,t.serviceEvents.emit({type:"cancelled",file:e.file})});break;case"remove":if(!e.id)return;var u=t.files.findIndex(function(t){return t.id===e.id});if(-1!==u){var l=t.files[u];t.files.splice(u,1),t.serviceEvents.emit({type:"removed",file:l})}break;case"removeAll":t.files.length&&(t.files=[],t.serviceEvents.emit({type:"removedAll"}))}})},e.prototype.uploadFile=function(e,t){var n=this;return new a.Observable(function(o){var a=t.url,s=t.method||"POST",u=t.data||{},l=t.headers||{},p=new FileReader,d=new XMLHttpRequest,c=(new Date).getTime(),f=0;d.upload.addEventListener("progress",function(t){if(t.lengthComputable){var n=Math.round(100*t.loaded/t.total),a=(new Date).getTime()-c;f=Math.round(t.loaded/a*1e3),e.progress={status:i.Uploading,data:{percentage:n,speed:f,speedHuman:r(f)+"/s",startTime:e.progress.data.startTime||(new Date).getTime(),endTime:null}},o.next({type:"uploading",file:e})}},!1),d.upload.addEventListener("error",function(e){o.error(e),o.complete()}),d.onreadystatechange=function(){if(d.readyState===XMLHttpRequest.DONE){var t=Math.round(e.size/((new Date).getTime()-e.progress.data.startTime)*1e3);e.progress={status:i.Done,data:{percentage:100,speed:t,speedHuman:r(t)+"/s",startTime:e.progress.data.startTime,endTime:(new Date).getTime()}};try{e.response=JSON.parse(d.response)}catch(t){e.response=d.response}o.next({type:"done",file:e}),o.complete()}},d.open(s,a,!0),d.withCredentials=!!t.withCredentials;var v=new FormData;try{var h=n.fileList.item(e.fileIndex),m=n.uploads.findIndex(function(e){return e.file.size===h.size});n.uploads[m].file.progress.status===i.Canceled&&o.complete(),v.append(t.fieldName||"file",h,h.name),Object.keys(u).forEach(function(e){return v.append(e,u[e])}),Object.keys(l).forEach(function(e){return d.setRequestHeader(e,l[e])}),n.serviceEvents.emit({type:"start",file:e}),d.send(v)}catch(e){o.complete()}return function(){d.abort(),p.abort()}})},e.prototype.generateId=function(){return Math.random().toString(36).substring(7)},e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return s});var r=n(0),i=(n.n(r),n(1)),o=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=function(){function e(e){this.elementRef=e,this.stopEvent=function(e){e.stopPropagation(),e.preventDefault()},this.upload=new i.c,this.uploadOutput=new r.EventEmitter}return e.prototype.ngOnInit=function(){var e=this;this.el=this.elementRef.nativeElement,this.upload.serviceEvents.subscribe(function(t){e.uploadOutput.emit(t)}),this.uploadInput instanceof r.EventEmitter&&this.upload.initInputEvents(this.uploadInput),this.el.addEventListener("drop",this.stopEvent,!1),this.el.addEventListener("dragenter",this.stopEvent,!1),this.el.addEventListener("dragover",this.stopEvent,!1)},e.prototype.ngOnDestroy=function(){this.uploadInput&&this.uploadInput.unsubscribe()},e.prototype.onDrop=function(e){e.stopPropagation(),e.preventDefault();var t={type:"drop"};this.uploadOutput.emit(t),this.upload.handleFiles(e.dataTransfer.files)},e.prototype.onDragOver=function(e){if(e){var t={type:"dragOver"};this.uploadOutput.emit(t)}},e.prototype.onDragLeave=function(e){if(e){var t={type:"dragOut"};this.uploadOutput.emit(t)}},e}();o([n.i(r.Input)(),a("design:type",r.EventEmitter)],s.prototype,"uploadInput",void 0),o([n.i(r.Output)(),a("design:type",r.EventEmitter)],s.prototype,"uploadOutput",void 0),o([n.i(r.HostListener)("drop",["$event"]),a("design:type",Function),a("design:paramtypes",[Object]),a("design:returntype",void 0)],s.prototype,"onDrop",null),o([n.i(r.HostListener)("dragover",["$event"]),a("design:type",Function),a("design:paramtypes",[Event]),a("design:returntype",void 0)],s.prototype,"onDragOver",null),o([n.i(r.HostListener)("dragleave",["$event"]),a("design:type",Function),a("design:paramtypes",[Event]),a("design:returntype",void 0)],s.prototype,"onDragLeave",null),s=o([n.i(r.Directive)({selector:"[ngFileDrop]"}),a("design:paramtypes",[r.ElementRef])],s)},function(e,t,n){"use strict";n.d(t,"a",function(){return s});var r=n(0),i=(n.n(r),n(1)),o=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=function(){function e(e){var t=this;this.elementRef=e,this.fileListener=function(){t.upload.handleFiles(t.el.files)},this.upload=new i.c,this.uploadOutput=new r.EventEmitter}return e.prototype.ngOnInit=function(){var e=this;this.el=this.elementRef.nativeElement,this.el.addEventListener("change",this.fileListener,!1),this.upload.serviceEvents.subscribe(function(t){e.uploadOutput.emit(t)}),this.uploadInput instanceof r.EventEmitter&&this.upload.initInputEvents(this.uploadInput)},e.prototype.ngOnDestroy=function(){this.el.removeEventListener("change",this.fileListener,!1),this.uploadInput&&this.uploadInput.unsubscribe()},e}();o([n.i(r.Input)(),a("design:type",r.EventEmitter)],s.prototype,"uploadInput",void 0),o([n.i(r.Output)(),a("design:type",r.EventEmitter)],s.prototype,"uploadOutput",void 0),s=o([n.i(r.Directive)({selector:"[ngFileSelect]"}),a("design:paramtypes",[r.ElementRef])],s)},function(e,t,n){"use strict";n.d(t,"a",function(){return s});var r=n(0),i=(n.n(r),n(2)),o=n(3),a=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},s=function(){function e(){}return e}();s=a([n.i(r.NgModule)({declarations:[o.a,i.a],exports:[o.a,i.a]})],s)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(4);n.d(t,"NgUploaderModule",function(){return r.a});var i=n(1);n.d(t,"UploadStatus",function(){return i.a}),n.d(t,"humanizeBytes",function(){return i.b}),n.d(t,"NgUploaderService",function(){return i.c});var o=n(3);n.d(t,"NgFileSelectDirective",function(){return o.a});var a=n(2);n.d(t,"NgFileDropDirective",function(){return a.a})},function(e,n){e.exports=t},function(e,t){e.exports=n},function(e,t){e.exports=r}])});
//# sourceMappingURL=ngx-uploader.umd.js.map